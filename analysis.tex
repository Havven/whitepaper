\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{mathtools}
\usepackage{svg}
\begin{document}
\title{Preliminary Havven System Analysis}
\date{}

\begin{figure}
    \centering
    \includesvg[width=0.33\textwidth]{block8logo}
\end{figure}
\maketitle

\section{Discussion}

This section will provide an informal treatment of the proposed market's structure
and dynamics, while section 2 will scaffold out its structure with a little more
formality.

\paragraph{Significant questions}
\begin{itemize}
    \item Should fees only be given to those who have actually issued nomins?
    \item How do we incentivise people to even transfer stuff.
    \item Are transfer fees charged only nomins? Would people not then just try to convert to curits and exchange there?
    \item Utilisation ratio needs to have distinct parts. Number of escrowed curits is not quite the same as the number of issued nomins.
    \item Why not allow the system to maintain a pool of curits/nomins that it itself can buy/sell?
    \item What if the system didn't burn the nomins that were handed back when curits were redeemed?
\end{itemize}

\pagebreak
\subsection{Restatement of Purpose}
We want to make a stablecoin in order to provide a currency which is a viable medium of exchange.
Evidently, such a coin must have a relatively stable price. We will do this by allowing users to back it,
automatically expanding and contracting the money supply as the well of capital fluctuates in value.
To this end, we will provide two intertwined tokens.
\paragraph{Curits} The reserve tokens, which users buy to obtain a part share in the entire system. The holders
of this token are providing collateral for the system, and in so doing, assume some level of risk, but will
be rewarded with fees the system levies automatically as part of its usual operation. The capitalisation
of the reserve market reflects the value of the entire system.
\paragraph{Nomins} The exchange tokens. Philosophically, we would like the nomin to be a utilon, a constant
unit of utility, and so the system should stabilise its price in terms of some external, relatively-stable
currency. Each holder of curits is granted the right to issue their own nomins, in proportion with the value
of the curits they hold and are willing to escrow. If the user wishes to redeem their escrowed curits,
they must present the system with nomins, in order to freely trade them again. Other than just price stability,
the system should also encourage liquidity, if nomins are to be actually-useful as a medium of exchange.


\pagebreak
\subsection{Investment incentives}
Why would anyone buy curits in the first place? A potential buyer of curits has at least three avenues for making
money in Havven.

\paragraph{Capital gains due to the appreciation of curits:}
Presumably the currency will appreciate due to a demand for curits that is founded in the intrinsic
utility of a stablecoin. Speculators will naturally be important players too.

\paragraph{Interest accrued from fees:}
If and when the price of curits stabilises, then this may be the only long term positive-expected
source of revenue. Ideally fees are set at a level where they are both high enough to be an incentive
for rent-seekers to hold curits in the long term (thus assuming the risk of providing collateral for
the system) and low enough not to be a disincentive for ordinary users to transact in nomins.
It is desirable, perhaps in a future world dominated by micropayments, for these fees to be
negligible for end users, while still being macroeconomically important for the system, and for those
who capitalise it.

\paragraph{Arbitrage profit:}
It is the arbitrageurs who will ultimately bring the price of nomins back into balance by a triangular circuit
through nomins, curits, and the external (crypto or fiat) markets. They might hold curits for a short time in order
to pursue this strategy.


\pagebreak
\subsection{Fees}
There are a number of questions to be asked, and answered:
\begin{itemize}
    \item What are fees for?
    \item Who gets those fees?
    \item When can fees be levied?
    \item What macroeconomic effect does this levy have as a coin travels through the system?
\end{itemize}

\paragraph{The purpose of fees}
Fees will be redistributed to those who back the system, in order to incentivise people to capitalise it.
The fee pool will be distributed periodically, for this purpose.
However, if the system determines that the nomin price is too low, then fees could be burned. If the price is
too high then perhaps the system could sell these back into the system at a discounted rate.

Fee collection rate will also be a direct measure of the velocity of money in Havven. So it's in the interest
of curit holders to maximise liquidity in order to maximise their return.

\paragraph{Fee beneficiaries}
The previous assumption was that fees would simply be awarded to any holder of curits. But then they
get all the upside with none of the risk. Although in the aggregate, it would be better for holders of 
curits if everyone issued nomins. The marginal return for any single player (who cannot issue a 
large fraction of all circulating nomins) of actually issuing them would not outweigh the risk they take
on in doing so. If a user can issue 1\% of circulating nomins, then doing so will only increase their
fee takings by 1\%.
Hence it it makes no sense to actually issue nomins for any single player; so nobody will do it.
We must improve the marginal benefit of issuing nomins into circulation in order to avoid
this tragedy of the commons situation. So fees must be paid to those who issue nomins, not just
those who hole curits.

\paragraph{When fees can be collected}
The system can potentially charge fees whenever any value is transferred, or any state is updated.
There are only a few circumstances that these things happen:
\begin{itemize}
    \item Nomin transfers
    \item Curit transfers
    \item Nomin issuance
    \item Curit redemption
\end{itemize}
The fee schedule could be altered dynamically in order to stabilise the system. It's even conceivable
that the system could set negative fee rates if it needed to.
We might also charge punitive fees if a user is above the targeted utilisation ratio.


\pagebreak
\subsection{Encouraging Liquidity}

It's desirable, when actors issue nomins, that they are actually injected into Havven.
The use of someone escrowing their curits is that they provide backing for the currency flowing through the system,
and so they should be rewarded for assuming this risk.
However, what's to stop someone issuing their nomins, and then just holding onto them? In this manner they
would accrue fees, but take on none of the risk of behaving spending those nomins, for they always have an instant
option to liquidate their position and escape. An actor who had done the economically-desirable thing, on
the other hand, who issues nomins and then spends them, would be forced to buy nomins in the open market in
order to redeem their escrowed curits.

But how to encourage a user to actually increase liquidity by buying goods with the nomins they hold? 


\subsubsection{Motility}

We would like to encourage a user to spend their nomins. So we can give them a motility score 
and they are paid fees in proportion with the product of this score, and the number of escrowed curits
they hold.

A user should not just be able to hold nomins and accrue fees. A user should not be able to just manipulate 
an account they control to have a high motility with small values and then dump a large value they want to hold
into it.

A user should not be able to cycle nomins through accounts they control and collect fees.

We would like to incentivise long transaction paths out of an account, and high out-degree nodes along those paths
(so money is actually liquid/fungible).
We don't like short cycles. We don't like isolated subgraphs. Would be cool if the money could go into the main
connected component of the transaction graph as quickly as possible, then circulate in there with high velocity.


\paragraph{Definitions}
\begin{align*}
    A \ &:= \ \text{The set of all accounts} \\
    V_{a \rightarrow b} \ &:= \ \text{total value transferred from \(a\) to \(b\)} \\
    V_{a \rightarrow a} \ &:= \ 0 \ \text{(accounts can't transfer to themselves)} \\
    V_{a}^{in} \ &:= \ \sum_{p \in A}{V_{p \rightarrow a}} \\
    V_{a}^{out} \ &:= \ \sum_{p \in A}{V_{a \rightarrow p}}
\end{align*}

We might interpret \(V_{a \rightarrow b}\) to be the sum of the weights on the edges in
the transaction multigraph corresponding to transactions between \(a\) and \(b\). \\

We would like to know how likely a nomin is to be spent from a given account. Its motility should measure this.

We might try to measure the probability that a coin will be spent soon, if it resides in an account \(a\).
We will take \(\mathcal{M}(a)\) to be the motility of \(a\), which should estimate that probability:
\begin{align*}
    \mathcal{M}(a) &:= \sum_{p \in A}{P(a \ \text{transfers to} \ p) \cdot \mathcal{M}(p)} \\
    &= \sum_{p \in A}{\frac{V_{a \rightarrow p}}{V_{a}^{in}} \cdot \mathcal{M}(p)} \\
    &= \frac{1}{V_{a}^{in}} \sum_{p \in A}{V_{a \rightarrow p} \cdot \mathcal{M}(p)}
\end{align*}

Intuitively, if you transfer a lot of money to high-motility accounts, then your own motility is
taken to be high.

\paragraph{Calculating Motility}
This will need to be calculated iteratively, and locally.
Note that \(V_{a \rightarrow p} = 0\) for \(p\) that \(a\) has never transferred to,
so those accounts can be neglected.
It's probably too costly to store the value of \(V_{a \rightarrow b}\) explicitly. So we will have
to eliminate this quantity in our expressions.
We will update motility scores whenever a new transaction from \(a\) to \(b\) of value \(v_{a \rightarrow b}\) is made.

\begin{align*}
    \intertext{Value into \(b\) increases, so \(\mathcal{M}(b)\) can be easily recalculated.} \\
    {V_{b}^{in}}' \ &\leftarrow \ V_{b}^{in} + v_{a \rightarrow b} \\
    \mathcal{M}'(b) \ &\leftarrow \ \frac{1}{{V_{b}^{in}}'} \sum_{p \in A}{V_{b \rightarrow p} \cdot \mathcal{M}'(p)} \\
    \intertext{Meanwhile, the value transferred from \(a\) to \(b\) also increases.}
    V'_{a \rightarrow b} \ &\leftarrow \ V_{a \rightarrow b} + v_{a \rightarrow b} \\
    \mathcal{M}'(a) \ &\leftarrow \ \frac{1}{V_{a}^{in}} \Big( V'_{a \rightarrow b} \cdot \mathcal{M}'(b) \ + \ \sum_{p \in A \backslash \{b\}}{V_{a \rightarrow p} \cdot \mathcal{M}'(p)}\Big)\\
    \intertext{Although these updates should also influence accounts which have (transitively) transferred into \(a\) and \(b\),
               we want to reward people for increasing liquidity today, rather than at some future time, and
               we take the motility of an account to be relatively stable after some time. As a result we will
               take \(\mathcal{M}'(p) \approx \mathcal{M}(p)\) for \(p \notin \{a, b\}\). Then:} 
    \mathcal{M}'(a) \ &\approx \ \frac{1}{V_{a}^{in}} \Big( (V_{a \rightarrow b} + v_{a \rightarrow b}) \cdot \mathcal{M}'(b) \ + \ \sum_{p \in A \backslash \{b\}}{V_{a \rightarrow p} \cdot \mathcal{M}(p)}\Big) \\
    &\approx \ \frac{v_{a \rightarrow b}}{V_{a}^{in}} \mathcal{M}'(b) \ + \frac{1}{V_{a}^{in}} \sum_{p \in A}{V_{a \rightarrow p} \cdot \mathcal{M}(p)} \\
    \intertext{So we will take our update step for a transaction from \(a\) to \(b\) to be the following:}
    {V_{b}^{in}}' \ &\leftarrow \ V_{b}^{in} + v_{a \rightarrow b} \\
    \mathcal{M}'(b) \ &\leftarrow \ \frac{V_{b}^{in}}{V_{b}^{in} + v_{a \rightarrow b}} \mathcal{M}(b) \\
    \mathcal{M}'(a) \ &\leftarrow \ \frac{v_{a \rightarrow b}}{V_{a}^{in}} \mathcal{M}'(b) \ + \mathcal{M}(a)
\end{align*}

Although, it may also be nice to add a decay term, so that accounts that have not moved any money in a long time
are taken to have a lower motility.


\pagebreak
\subsection{Utilisation Ratio}


\subsection{Failure Modes}
\subsubsection{Liquidity Trap}
\subsubsection{Trapped Currency}

\pagebreak
\section{System Variables}
\hfill

\paragraph{Money Supply}
\begin{align*}
    C & \ && \text{(curits)} && \text{ : Quantity of curits, should be constant} \\
    C_e &= C \cdot U \ && \text{(curits)} && \text{ : Quantity of reserved curits, i.e. the value of tokens have been issued against } \\
    N &= \frac{U_a \cdot C \cdot P_c}{P_n} \ && \text{(nomins)} && \text{ : Quantity of nomins. This can float.}
\end{align*}
\\

\paragraph{Utilisation Ratios} We should work out a good level for \(U_{max}\).
\begin{align*}
    U &= \frac{P_n \cdot N}{C_e \cdot P_c} \ && \text{(dimensionless)} && \text{ : Empirical issuance ratio. } \\
    U_{max} & \ && \text{(dimensionless)} && \text{ : Targeted issuance ratio ceiling. Ideally, } 0 \leq U \leq U_{max} \leq 1
\end{align*}
\\

\paragraph{Prices} These values are important, with the goal of stabilising the nomin price.
\begin{align*}
    P_c & \ && (\frac{\text{\$}}{\text{curits}}) && \text{ : curit price} \\
    P_n & \ && (\frac{\text{\$}}{\text{nomins}}) && \text{ : nomin price} \\
    P_c' &= \alpha \cdot f(V_n, V_v) \cdot R && (\frac{\text{\$}}{\text{nomins} \cdot \text{seconds}}) && \text{ : R a risk term incorporating volatility? \#buyers - \#sellers?})
\end{align*}
\\

\paragraph{Fees}
\[F_x, F_i, F_r \ \text{(dimensionless) : transfer, issuance, redemption fees; these should be ratios, e.g. 0.1\%}\]
\\

\paragraph{Money Movement}
\begin{align*}
    V_n &= S_n \cdot N \ && (\frac{nomins}{seconds}) && \text{ : nomin transfer rate} \\
    V_v &= V_i + V_r \ && (\frac{curits}{seconds}) && \text{ : nomin} \leftrightarrow \text{curit conversion rate.} \\
    V_i &= (C - C_e) \cdot S_i \ && (\frac{curits}{seconds}) && \text{ : nomin issuance rate. Assumed to grow as there are more free curits in the system (actually should probably grow with the number of escrowed but unissued nomins).} \\
    V_r &= C_e \cdot S_r \ && (\frac{curits}{seconds}) && \text{ : rate at which curits are redeemed in return for nomins (which are burned). Assumed to grow proportionally with the number of escrowed curits.}
\end{align*}
\\

\paragraph{Microeconomic Variables} These should be defined as functions of \(P_n, P_c, \text{fees, etc.}\)
\begin{align*}
S_n \ && (\frac{1}{\text{seconds}}) && \text{ : average nomin spend rate} \\
S_i \ && (\frac{1}{\text{seconds}}) && \text{ : average issuance rate} \\
S_r \ && (\frac{1}{\text{seconds}}) && \text{ : average redemption rate}
\end{align*}

\end{document}

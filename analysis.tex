\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{amssymb}
\usepackage{mathtools}
\usepackage{svg}
\begin{document}

% Macros
\newcommand{\CUR}{\textsc{cur}}
\newcommand{\NOM}{\textsc{nom}}


\title{Preliminary Havven System Analysis}
\date{}

\begin{figure}
    \centering
    \includesvg[width=0.33\textwidth]{block8logo}
\end{figure}
\maketitle

\section{Discussion}

This section will provide an informal treatment of the proposed market's structure
and dynamics, while section 2 will scaffold out its structure with a little more
formality, including the definitions of all the important system variables.
If you see an unfamiliar symbol in section 1, look up its definition in section 2.

\paragraph{Significant questions}
\begin{itemize}
    \item Should fees only be given to those who have actually issued nomins?
    \item How do we incentivise people to even transfer stuff.
    \item Are transfer fees charged only nomins? Would people not then just try to convert to curits and exchange there?
    \item Utilisation ratio needs to have distinct parts. Number of escrowed curits is not quite the same as the number of issued nomins.
    \item Why not allow the system to maintain a pool of curits/nomins that it itself can buy/sell?
    \item What if the system didn't burn the nomins that were handed back when curits were redeemed?
\end{itemize}

\pagebreak
\subsection{Restatement of Purpose}
We want to make a stablecoin in order to provide a currency which is a viable medium of exchange.
Evidently, such a coin must have a relatively stable price. We will do this by allowing users to back it,
automatically expanding and contracting the money supply as the well of capital fluctuates in value.
To this end, we will provide two intertwined tokens.
\paragraph{Curits} The reserve tokens, which users buy to obtain a part share in the entire system. The holders
of this token are providing collateral for the system, and in so doing, assume some level of risk, but will
be rewarded with fees the system levies automatically as part of its usual operation. The capitalisation
of the reserve market reflects the value of the entire system.
\paragraph{Nomins} The exchange tokens. Philosophically, we would like the nomin to be a utilon, a constant
unit of utility, and so the system should stabilise its price in terms of some external, relatively-stable
currency, or perhaps a commodity basket in order to insulate the nomin price from the volatility of its 
underpinning currency. Each holder of curits is granted the right to issue their own nomins, in proportion
with the value of the curits they hold and are willing to escrow. If the user wishes to redeem their escrowed curits,
they must present the system with nomins, in order to freely trade them again. Other than just price stability,
the system should also encourage liquidity, if nomins are to be actually-useful as a medium of exchange.


\pagebreak
\subsection{Investment incentives}
Why would anyone buy curits in the first place? A potential buyer of curits has at least three avenues for making
money in Havven.

\paragraph{Capital gains due to the appreciation of curits:}
Presumably the currency will appreciate due to a demand for curits that is founded in the intrinsic
utility of a stablecoin. Speculators will naturally be important players too.

\paragraph{Interest accrued from fees:}
If and when the price of curits stabilises, then this may be the only long term positive-expected
source of revenue. Ideally fees are set at a level where they are both high enough to be an incentive
for rent-seekers to hold curits in the long term (thus assuming the risk of providing collateral for
the system) and low enough not to be a disincentive for ordinary users to transact in nomins.
It is desirable, perhaps in a future world dominated by micropayments, for these fees to be
negligible for end users, while still being macroeconomically important for the system, and for those
who capitalise it.

\paragraph{Arbitrage profit:}
It is the arbitrageurs who will ultimately bring the price of nomins back into balance by a triangular circuit
through nomins, curits, and the external (crypto or fiat) markets. They might hold curits for a short time in order
to pursue this strategy.


\pagebreak
\subsection{Fees}
There are a number of questions to be asked, and answered:
\begin{itemize}
    \item What are fees for?
    \item Who gets those fees?
    \item When can fees be levied?
    \item What macroeconomic effect does this levy have as a coin travels through the system?
\end{itemize}

\paragraph{The purpose of fees}
Fees will be redistributed to those who back the system, in order to incentivise people to capitalise it.
The fee pool will be distributed periodically, for this purpose.
However, if the system determines that the nomin price is too low, then fees could be burned. If the price is
too high then perhaps the system could sell these back into the system at a discounted rate.

Fee collection rate will also be a direct measure of the velocity of money in Havven. So it's in the interest
of curit holders to maximise liquidity in order to maximise their return.

\paragraph{Fee beneficiaries}
The previous assumption was that fees would simply be awarded to any holder of curits. But then they
get all the upside with none of the risk. Although in the aggregate, it would be better for holders of 
curits if everyone issued nomins. The marginal return for any single player (who cannot issue a 
large fraction of all circulating nomins) of actually issuing them would not outweigh the risk they take
on in doing so. If a user can issue 1\% of circulating nomins, then doing so will only increase their
fee takings by 1\%.
Hence it it makes no sense to actually issue nomins for any single player; so nobody will do it.
We must improve the marginal benefit of issuing nomins into circulation in order to avoid
this tragedy of the commons situation. So fees must be paid to those who issue nomins, not just
those who hold curits.

\paragraph{When fees can be collected}
The system can potentially charge fees whenever any value is transferred, or any state is updated.
There are only a few circumstances that these things happen:
\begin{itemize}
    \item Nomin transfers
    \item Curit transfers
    \item Nomin issuance
    \item Curit redemption
\end{itemize}
The fee schedule could be altered dynamically in order to stabilise the system. It's even conceivable
that the system could set negative fee rates if it needed to.
We might also charge punitive fees if a user is above the targeted utilisation ratio.


\pagebreak
\subsection{Encouraging Liquidity}

It's desirable, when actors issue nomins, that they are actually injected into Havven.
The use of someone escrowing their curits is that they provide backing for the currency flowing through the system,
and so they should be rewarded for assuming this risk.
However, what's to stop someone issuing their nomins, and then just holding onto them? In this manner they
would accrue fees, but take on none of the risk of behaving spending those nomins, for they always have an instant
option to liquidate their position and escape. An actor who had done the economically-desirable thing, on
the other hand, who issues nomins and then spends them, would be forced to buy nomins in the open market in
order to redeem their escrowed curits.

But how to encourage a user to actually increase liquidity by buying goods with the nomins they hold? 


\subsubsection{Motility}

We would like to encourage a user to spend their nomins. So we can give them a motility score 
and they are paid fees in proportion with the product of this score, and the number of escrowed curits
they hold.

A user should not just be able to hold nomins and accrue fees. A user should not be able to just manipulate 
an account they control to have a high motility with small values and then dump a large value they want to hold
into it.

A user should not be able to cycle nomins through accounts they control and collect fees.

We would like to incentivise long transaction paths out of an account, and high out-degree nodes along those paths
(so money is actually liquid/fungible).
We don't like short cycles. We don't like isolated subgraphs. Would be cool if the money could go into the main
connected component of the transaction graph as quickly as possible, then circulate in there with high velocity.


\paragraph{Definitions}
\begin{align*}
    A \ &: \ \text{The set of all accounts} \\
    T \ &: \ \text{The multiset of all transactions; a subset of \(A \times A \times \mathbb{N}.\)} \\
    T_{a \rightarrow b} \subseteq T \ &: \ \text{The set of transactions from \(a\) to \(b\) with \(a, \ b \ \in A\).} \\
    v_t \ &: \ \text{the value of a transaction} \ t \in T. \\
    V_{a \rightarrow b} \ &:= \ \sum_{t \in T_{a \rightarrow b}}{v_t} \ \ \text{(the total value transferred from \(a\) to \(b\))} \\
    V_{a}^{in} \ &:= \ \sum_{p \in A}{V_{p \rightarrow a}} \\
    V_{a}^{out} \ &:= \ \sum_{p \in A}{V_{a \rightarrow p}} \\
    \intertext{Note that \(T_{a \rightarrow a} := \varnothing \), and hence \(V_{a \rightarrow a} = 0\)
               (accounts can't transfer to themselves).}
    \intertext{We might interpret \((A, T)\) as a weighted multigraph of transactions, 
               with each transaction \(t \in T_{a \rightarrow b}\)
               corresponding to a weighted edge in that graph between nodes \(a\) and \(b\).}
\end{align*}

\noindent We would like to know how likely a nomin is to be spent soon from a given account.
The motility of the account should measure this. Considering an account \(a\), we will take
\(\mathcal{M}(a)\) to be the motility of \(a\):
\begin{align*}
    \mathcal{M}(a) &:= \sum_{p \in A}{P(a \ \text{transfers to} \ p) \cdot \mathcal{M}(p)} \\
    &= \sum_{p \in A}{\frac{V_{a \rightarrow p}}{V_{a}^{in}} \cdot \mathcal{M}(p)} \\
    &= \frac{1}{V_{a}^{in}} \sum_{p \in A}{V_{a \rightarrow p} \cdot \mathcal{M}(p)}
\end{align*}

Intuitively, if you transfer a lot of money to high-motility accounts, then your own motility is
taken to be high.

\paragraph{Calculating Motility}
This will need to be calculated iteratively, and locally.
Note that \(V_{a \rightarrow p} = 0\) for \(p\) that \(a\) has never transferred to,
so those accounts can be neglected.
It's probably too costly to store the value of \(V_{a \rightarrow b}\) explicitly. So we will have
to eliminate this quantity in our expressions.
We will update motility scores whenever a new transaction \(t\) from \(a\) to \(b\) of value \(v_t\) is made.
\begin{align*}
    \intertext{Value into \(b\) increases, so \(\mathcal{M}(b)\) can be easily recalculated.} \\
    {V_{b}^{in}}' \ &\leftarrow \ V_{b}^{in} + v_t \\
    \mathcal{M}'(b) \ &\leftarrow \ \frac{1}{{V_{b}^{in}}'} \sum_{p \in A}{V_{b \rightarrow p} \cdot \mathcal{M}'(p)} \\
    \intertext{Meanwhile, the value transferred from \(a\) to \(b\) also increases.}
    V'_{a \rightarrow b} \ &\leftarrow \ V_{a \rightarrow b} + v_t \\
    \mathcal{M}'(a) \ &\leftarrow \ \frac{1}{V_{a}^{in}} \Big( V'_{a \rightarrow b} \cdot \mathcal{M}'(b) \ + \ \sum_{p \in A \backslash \{b\}}{V_{a \rightarrow p} \cdot \mathcal{M}'(p)}\Big)\\
    \intertext{Although these updates should also influence accounts which have (transitively) transferred into \(a\) and \(b\),
               we want to reward people for increasing liquidity today, rather than at some future time, and
               we take the motility of an account to be relatively stable after some time. As a result we will
               take \(\mathcal{M}'(p) \approx \mathcal{M}(p)\) for \(p \notin \{a, b\} \). Then:} 
    \mathcal{M}'(a) \ &\approx \ \frac{1}{V_{a}^{in}} \Big( (V_{a \rightarrow b} + v_t) \cdot \mathcal{M}'(b) \ + \ \sum_{p \in A \backslash \{b\}}{V_{a \rightarrow p} \cdot \mathcal{M}(p)}\Big) \\
    &\approx \ \frac{v_t}{V_{a}^{in}} \mathcal{M}'(b) \ + \frac{1}{V_{a}^{in}} \sum_{p \in A}{V_{a \rightarrow p} \cdot \mathcal{M}(p)} \\
    \intertext{So we will take our update step for a transaction \(t\) from \(a\) to \(b\) to be the following:}
    {V_{b}^{in}}' \ &\leftarrow \ V_{b}^{in} + v_t \\
    \mathcal{M}'(b) \ &\leftarrow \ \frac{V_{b}^{in}}{V_{b}^{in} + v_t} \mathcal{M}(b) \\
    \mathcal{M}'(a) \ &\leftarrow \ \frac{v_t}{V_{a}^{in}} \mathcal{M}'(b) \ + \mathcal{M}(a)
\end{align*}

\noindent However, it may also be nice to add a decay term, so that accounts that have not moved any money in a long time
are taken to have a lower motility.


\pagebreak
\subsection{Utilisation Ratio}

It's not clear to me exactly what purpose \(U_{max}\) serves. It certainly keeps the value of the pool of
curits below the value of the pool of nomins, assuming there is no devaluation of a ratio more severe than 
\(U_{max}\) itself. However, if the system has adequate mechanisms enforce \(U\ \leq U_{max}\), then
why not simply allow users to issue nomins up to the maximum value of curits they have escrowed? \\

\noindent A low \(U_{max}\) seems like it would place upward pressure on the price of nomins.
Consider a situation where \(U_{max} = 0.2\), and I have an impecunious friend, Jake, who owns a wallet which
has issued \$20 worth of nomins on the back of \$100 of escrowed curits. At the moment, he has no
money, but his wallet is worth \$80, since he can burn \$20 worth of nomins to get at those curits.
So Jake should be willing to pay anywhere up to \$80 to buy enough nomins to free up the curits.
This situation will still motivate Jake until the price of the nomins he's issued is equal to the
price of the curits he's escrowed. That is, until the price of a nomin is worth five times the price of
a curit.\\

\noindent Finally, let's consider the impact of the utilisation ratio on a curit investor's value proposition.
Examine the aggregate fees collected from nomin transfers \(Ag_{nx}\), and expand out its definition:
\[Ag_{nx} = \frac{F_{nx} \cdot S_n \cdot C \cdot P_c \cdot U}{P_n}\]
This quantity is proportional with the actual utilisation ratio \(U\). The more nomins that have
been issued, the more fees are returned. So if \(U = 0.2\), then if the system would like to return 
a fee rate of 5\% per annum to curit-holders, then fees to the tune of 25\% per year will have to be
levied on nomin transfers, assuming no other fees exist. This may be a little high.

\pagebreak
\subsection{Failure Modes}
\subsubsection{Liquidity Trap}
\subsubsection{Trapped Currency}

\pagebreak
\section{System Variables}

\hfill

\noindent What follows are the main variables of the system. 
Under each heading, each row will correspond to a single quantity of interest.
Each row will have three columns. Leftmost, a mathematical definition of the variable; in the middle,
the dimension of the quantity (which units it is measured in); and on the rightmost, a short
english summary of the variable.\\

\noindent Certain abbreviations will be used.
For example, \(\CUR{}\) and \(\NOM{}\) will be used as abbreviations for curits and nomins considered as
units of measurement. \\

\paragraph{Prices}
\begin{align*}
    P_c & \ && &(\frac{\text{\$}}{\CUR{}}) && &\text{ : curit price.} \\
    P_n & \ && &(\frac{\text{\$}}{\NOM{}}) && &\text{ : nomin price.} \\
    \pi &:= \frac{P_c}{P_n} \ && &(\frac{\NOM{}}{\CUR{}}) && &\text{ : curit to nomin conversion factor.} \\
    P_c' &= f(V_n, V_v) \cdot R && &(\frac{\text{\$}}{\NOM{} \cdot \text{sec}}) && &\text{ : curit price rate of change.}
    \intertext{Here \(R\) is a risk term incoporating, for example, volatility, number of buyers versus sellers, and so on.}
\end{align*}
\\


\paragraph{Money Supply}
\begin{align*}
    &C \ && &(\CUR{}) && &\text{ : Quantity of curits, which is constant.} \\
    % &C_e \ && &(\CUR{}) && &\text{ : Quantity of escrowed curits.} \\
    &N = C_N \cdot \pi \ && &(\NOM{}) && &\text{ : Quantity of nomins. This can float.} \\
    &C_N = \frac{N}{\pi} \ && &(\CUR{}) && &\text{ : Curit value of issued nomins.}
\end{align*}
\\

\paragraph{Utilisation Ratios}
\begin{align*}
    &U = \frac{C_N}{C} \ && &\text{(dimensionless)} && &\text{ : Empirical issuance ratio. } \\
    &U_{max} \ && &\text{(dimensionless)} && &\text{ : Targeted issuance ratio ceiling.}
    \intertext{Ideally, \(0 \leq U \leq U_{max} \leq 1\), but we need to work out a good level for \(U_{max}\).}
\end{align*}
\\

\paragraph{Microeconomic Variables} These should be defined as functions of \(P_n, \ P_c, \ \text{fees, etc.}\)
\begin{align*}
S_n \ && (\frac{1}{\text{sec}}) && &\text{ : average nomin spend rate} \\
S_i \ && (\frac{1}{\text{sec}}) && &\text{ : average issuance rate} \\
S_r \ && (\frac{1}{\text{sec}}) && &\text{ : average redemption rate}
\end{align*}
\\

\paragraph{Money Movement}
\begin{align*}
    V_n &= S_n \cdot N \ && &(\frac{\NOM{}}{\text{sec}}) && &\text{ : nomin transfer rate.} \\
    V_v &= V_i + V_r \ && &(\frac{\CUR{}}{\text{sec}}) && &\text{ : nomin} \leftrightarrow \text{curit conversion rate.} \\
    V_i &= (C - C_N) \cdot S_i \ && &(\frac{\CUR{}}{\text{sec}}) && &\text{ : nomin issuance rate.} \\
    V_r &= C_N \cdot S_r \ && &(\frac{\CUR{}}{\text{sec}}) && &\text{ : curit redemption rate.} \\
    \intertext{\(V_i\) is assumed to grow as there are more free curits in the system.
               Actually perhaps it should grow with the number of escrowed curits with
               no nomins issued against them.}
    \intertext{\(V_r\), by contrast, is taken to grow proportionally with the number of escrowed curits.}
\end{align*}
\\

\paragraph{Fees}
\begin{align*}
\intertext{The following fees are ratios, for example 0.1\%, levied on each transaction.}
&F_{nx} & \ && &\text{(dimensionless)} && &\text{ : nomin transfer fee} \\
&F_{cx} & \ && &\text{(dimensionless)} && &\text{ : curit transfer fee} \\
&F_i & \ && &\text{(dimensionless)} && &\text{ : nomin issuance fee} \\
&F_r & \ && &\text{(dimensionless)} && &\text{ : curit redemption fee} \\
\intertext{These quantities are the aggregated fees accrued by the system per unit time.}
&Ag_{nx} &:= V_n \cdot F_{nx} \ && &(\frac{\NOM{}}{\text{sec}}) && &\text{ : fees taken from nomin transfers.} \\
\end{align*}

\end{document}

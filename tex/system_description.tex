\section{System Description} Havven is a dual-token system that, combined with a set of novel incentive mechanisms, stabilises the price of the nomin with respect to an external asset. Users of the nomin token pay the owners of the havven token for collateralising and stabilising the system. \\

\noindent The havven token incentivises those who hold it to fulfil two functions:

\begin{itemize}
\item{To provide the system with collateral.}
\item{To participate in the stabilisation of the nomin price.}
\end{itemize}

\vspace{2mm}

\noindent \textbf{Collateralisation}
\vspace{2mm}

\noindent Confidence in the stability of the nomin begins with overcollateralisation, so that the value of escrowed havvens is greater than the value of nomins in circulation. The value of havvens is derived internally by the system as a function of the demand for nomins; this decouples the value of the collateral pool from market speculation.

\vspace{2mm}

\noindent As long as the ratio of total nomin value to total havven value remains favourable,
there is sufficient backing in the underlying collateral pool to ensure that nomins
can be redeemed for their face value. The redeemability of a nomin for the havvens
against which it was issued strongly supports a stable price. \\

\vspace{2mm}

\noindent \textbf{Stabilisation Incentives}
\vspace{2mm}

\noindent Havven rewards those that have issued nomins. These rewards are derived from transaction fees and are distributed in proportion with how well each issuer maintains the correct nomin supply. The system monitors the nomin price, and responds by adjusting its targeted global supply, which individual issuers are incentivised to move towards.

\vspace{2mm}

\noindent Where volatility persists, stronger stabilisation mechanisms may be applied such as automated collateral recovery. Where a significant portion of nomins are being used for hedging, (and hence not generating transaction fees) a charge can be applied to ensure that the cost of utility for hedging is not being solely borne by transactions.

\newpage

\subsection{Equilibrium Nomin Price}

\noindent We first introduce the core system variables:

\begin{align*}
H &:= \text{havven quantity} & N &:= \text{nomin quantity} \\
P_h &:= \text{havven price}  & P_n &:= \text{nomin price} \\
\end{align*}

% \todo[inline]{Consider renaming havven price symbol to reflect that it is computed from income}

\noindent All havven tokens are created at initialisation, so $H$ is constant.
The quantity of nomins $N$ floats, responding to the issuance actions of havven holders.
The Havven system needs to incentivise issuers to maintain $N$ such that
the nomin price, $P_n$, is stable at \$1.
As we proceed, we may subscript variables with $t$ to indicate the value of that
variable at a given time. \\

\noindent In Havven, the measure of the value of nomins against the value
of havvens is called the collateralisation ratio:

\begin{equation}
C = \frac{P_n \cdot N}{P_h \cdot H} \label{eq:collateralisation}
\end{equation}

\vspace{3 mm}

\noindent From the law of supply and demand, there exists some supply
of nomins, $N_{opt}$, where the related level of demand yields an equilibrium
price of \$1. This quantity is associated with an optimal collaterisation ratio,
$C_{opt}$. We visualise this equilibrium below with a hypothetical demand
curve, D, and a supply curve, S.  \\

% \todo[inline]{curved lines}
% \todo[inline]{make diagrams pretty}
\begin{center}
\begin{tikzpicture}[scale=3]

% draw axes
\draw [<->, thick] (0,2) node (yaxis) [above] {$P_n$} |- (2.5,0) node (xaxis) [right] {$N$};

% draw intersecting lines
\draw (0.5, 0.5) coordinate (a_1) -- (2,1.8) coordinate (a_2) node[pos=0.0, left] {S};
\draw (0.5, 1.8) coordinate (b_1) -- (2,0.5) coordinate (b_2) node[pos=1.0, right] {D};

% calculate coordinate of intersection
\coordinate (c) at (intersection of a_1--a_2 and b_1--b_2);

\draw[dashed] (yaxis |- c) node [left] {$1$} -| (xaxis -| c) node[below] {$N_{opt} = \frac{C_{opt} \cdot P_h \cdot H}{P_n}$};

\end{tikzpicture}
\end{center}

\noindent The system is unable to influence the demand for nomins. We assume that some level of demand exists given the utility of nomins as a stable cryptocurrency. Although demand cannot be manipulated, the supply of nomins is controlled by havven holders, whose issuance incentives are in turn controlled by the system. It follows that as we require a fixed price $P_n = \$1 $ and are unable to control either $P_h$ or $H$, we must manipulate $C_{opt}$ such that $N = N_{opt}$ in order to satisfy our requirement.

\subsection{Intrinsic Havven Value}

\noindent Being freely-tradable ERC20 tokens, havvens will have a market price which, like
the nomin price, can be measured with an oracle. In the initial phases, while nomin demand is low, 
we will use a seven day rolling average of the market price for both havvens and nomins. This rolling
average is designed to smooth out fluctuations in the market price and increase the cost of attacking the
system. However, once nomin transaction volume has increased to sufficient levels, we may transition to a different
havven-valuation system that attempts to more directly connect the valuation of the havven with demand for nomins. \\

\noindent One problem with using the market price for $P_h$ is that it exposes the
collateralisation ratio computation to speculative price shocks.
Instead, the ``true'' price of a havven can be computed as a function of the transaction
fees that the system charges. In this way we connect the computed price of the havven directly with
nomin velocity.
Valuation increases will allow an expansion in the money supply exactly when demand has expanded,
while contractions in the money supply will be incentivised exactly when demand has contracted. \\

\noindent We define the value of a havven as a share in the discounted sum over past fee returns.
In this way the price is not vulnerable to instantaneous volume spikes, while
taking the most recent transaction volumes to be the most highly-correlated with future volumes.

\begin{equation}
    P_{h,t} = \frac{1}{H} \sum_{t'=1}^{t} \frac{F_{t - t'}}{(1 + r)^{t'}} \label{eq:price}
\end{equation}

where

\begin{align*} 
& P_{h,t} \text{ is the price of one havven at time } t  \\
& F_t \text{ is the total fees collected in period } t\\
& r \text{ is a falloff term}  \\
\end{align*}

\newpage

\noindent This can be computed efficiently, because $P_{h,t+1} = \frac{P_{h,t} + F_t}{r}$. 
Further, if it is assumed that the average fee take is approximated by $F_t$, and $t$ is large, then

\begin{equation}
    P_{h,t} \approx \frac{1}{H} \sum_{t'=1}^{\infty} \frac{F_t}{(1 + r)^{t'}} = \frac{F_t}{H \cdot r}
\end{equation}


\subsection{Issuance and Collateralisation} 

% \todo[inline]{separate wallets from accounts}

\noindent Havven's goal is to remain overcollateralised. In order to do so, the system defines a collaterisation target:

\begin{equation}
0 < C_{opt} < 1  \label{eq:target}
\end{equation}

\vspace{3 mm}

\noindent It is necessary at this point to distinguish, for an account $i$, between the nomins it contains $N_i$ (equity) and the nomins it has been issued $\check{N_i}$ (debt). Note that globally, the $\sum_{i}N_i = \sum_{i}\check{N_i}$, as all circulating nomins were issued by some account. However, a given account may have a balance different from its issuance debt.\\
% \todo[inline]{Make sure this equity/debt language is not too security-like.}

\noindent Hence we can define the collateralisation ratio for an individual account $i$ in terms of its issuance debt:

\begin{equation}
C_i = \frac{P_n \cdot \check{N_i}}{P_h \cdot H_i}  \label{eq:individualcollat}
\end{equation}

\vspace{3 mm}

\noindent The system provides incentives for individual issuers to bring their $C_i$ closer to $C_{opt}$ while maintaining $C_{opt}$ itself at a level that stabilises the price.

\paragraph{Nomin Issuance}

\noindent The nomin issuance mechanism allows Havven to reach its collaterisation target.
Issuing nomins escrows some quantity of havvens, which cannot be moved until they are unescrowed.
The quantity of havvens $\check{H_i}$ locked in generating $\check{N_i}$ nomins is:

\begin{equation}
\check{H_i} = \frac{P_n \cdot \check{N_i}}{P_h \cdot C_{max}}  \label{eq:escrowed}
\end{equation}

\vspace{3 mm}

\noindent Under equilibrium conditions, there is some $\check{H_i} \leq H_i$
when $C_i = C_{opt}$, which the issuer is incentivised to target.
These incentives are provided in the form of transaction fees,
discussed in section 2.4. It is important to note that the issuer may
voluntarily increase their $C_i$ up to the limit of $C_{max}$; for example if
they anticipate a positive movement in $C_{opt}$. \\

\noindent On the other hand, an issuer may not issue a quantity of nomins
that would lock more than $H_i$ havvens. 
Consequently, $C_i$ may never exceed $C_{max}$, except by price fluctuations,
and in such circumstances, issuers are rewarded for bringing $C_i$ back under $C_{max}$. \\

\noindent After generating the nomins, the system places a \textbf{limit sell} order with a price of \$1 on a decentralised exchange. This means that the nomins will be sold at the current market price, down to a minimum price of \$1. If we assume implementation on Ethereum, then the nomins are sold for an equivalent value in ether, with the proceeds of the sale remitted to the issuer.

\paragraph{Nomin Destruction}

\noindent In order to access the original havvens that have been escrowed, the issuer must return the same quantity of nomins to the system to be burned. This is a main way 
an issuer can reduce their collateralisation ratio. If an issuer does not possess the required nomins, they can be purchased on the open market.

\subsubsection{Issuance Example}
% \todo[inline]{Finish the example. I don't really know if dealing with nomin price changes here is right, before introducing fees.}

\begin{enumerate}
\item{Bob purchases 100 havvens at \$1 each, total value \$100. The maximum collateralisation ratio $C_{max}$ is 0.5, the optimum collateralisation ratio $C_{opt}$ is 0.4 and the nomin price $P_n$ is \$1.}
\item{Bob decides to issue nomins up to $C_{opt}$. By equation \eqref{eq:escrowed}, the system generates 40 nomins and escrows 80 of his havvens, locking \$80 worth of value in the system $ (\check{N_i} \cdot C_{max})$.}
\item{The system sells the nomins on the market for \$40 worth of ether, transferring it to his account}.
\item{The havven price drops to \$0.90. The value of his havvens has decreased to \$90 which means his $C_i$ has increased to 0.44, greater than $C_{opt}$. The system escrows more of Bob's havvens to maintain the value of the locked collateral.}
\item{By \eqref{eq:escrowed} the system escrows an extra 8.9 of his havvens. He now has 88.9 havvens escrowed. The value locked in the system remains unchanged at \$80.}
\item{The havven price then increases back to \$1. The value of his havvens has increased to \$100 and his $C_i$ has decreased back to 0.4. The system releases the 8.9 havvens back to Bob and he has 80 escrowed.}
\end{enumerate}

\noindent The above example has illustrated how the system maintains the value of the underlying collateral by adjusting the quantity of a user's escrowed havvens as the havven price changes.

%\subsubsection{Price changes (Table here maybe?)}

%\noindent \emph{What happens if the price of havvens changes?} \\

%\noindent All issuance of nomins is done at the current $P_h$. However, when $P_h$ changes, the quantity of escrowed havvens changes with it (not the \emph{value}). An increase in $P_h$ means that fewer of Bob's havvens are escrowed. In contrast, a decrease in the $P_h$ means that more of his havvens are escrowed. This process occurs automatically in order to ensure that the system remains overcollateralised. \\ 

%\noindent \emph{What happens if the price of nomins changes?} \\ 

%\noindent In order to release escrowed havvens, Bob must return the same quantity of nomins that he issued. This means that if $P_n$ has increased in the market, he will need to spend more ether than he received when he issued in order to release his havvens. Conversely, if $P_n$ has decreased, Bob will need to spend less in order to release his havvens.

%\subsubsection{Global collaterilisation Ratio}

%\noindent Havven can ensure that nomins are overcollateralised at the time of issuance, however, a reduction in $P_h$ lowers the value of the escrowed havvens. The global collaterilisation ratio is defined as the total value of nomins divided by the total value of havvens:

%$$ U = \frac{P_n \cdot N}{P_h \cdot H}.$$ \\

%\noindent Intuitively, if $U = 1$, the value of nomins and havvens are equal. Hence, given our overcollateralisation property, the system targets $U <  1$. To do this, Havven only allows the issuance of nomins up to a maximum collaterilisation ratio.

%\subsubsection{Unique Collateralisation Ratio}

% \noindent Given the need to adjust the supply of nomins, an optimum collaterilisation ratio is defined as the point at which maximum incentives are applied:

% $$ 0 \leq U_{opt} \leq U_{max} \leq 1.$$

% \noindent Each havven holder that has issued nomins has a unique collaterilisation ratio, $ U_i $. The system can measure the degree to which their $ U_i $ is above or below the optimum and reward them accordingly. In this way the system incentivises the issuance and destruction of nomins. $ U_{opt} $ is defined formally below in terms of $ P_n $. As  the nomin price diverges from the desired \$1, the incentive to either expand or contract nomin supply increases.

\newpage
\subsection{Transaction Fees} Havven needs a direct incentive mechanism that can correct changes in the global collaterisation ratio, $C$, when the price of havvens or nomins changes. \\

\noindent Some of the equations below are defined in the discrete time domain and are referenced with a subscript $t$. These will be specifically used in our game theoretic modelling.

\subsubsection{Nomin Transaction Fees} Every time a nomin transaction occurs, the Havven system charges a small transaction fee. Transaction fees allow the system to generate revenue, which it can distribute to havven holders as an incentive to maintain nomin supply at $C_{opt}$. \\

\noindent The fee rate charged on nomin transactions is $\alpha_c$. It is constant and will be sufficiently small that it provides little to no friction for the user.\\

\begin{equation}
\alpha_c = k \ \label{eq:5}
\end{equation}

\begin{center}
\begin{tikzpicture}[scale=3]

% draw axes
\draw [<->, thick] (0,2) node (yaxis) [above] {$\alpha_c$} |- (2.5,0) node (xaxis) [right] {$P_N$};

% draw one line
\draw (0.0, 0.75) coordinate (a_1) -- (2.4,0.75) coordinate (a_2);

\coordinate (c) at (1.75, 0.75);

\draw[dashed] (yaxis |- c) node [left] {k};

\end{tikzpicture}
\end{center}

\noindent We may then express the total fees collected in period $t$, $F_t$, as a function
of the velocity of nomins $v_t$ and the total nomin supply $N_t$:

\begin{equation}
    F_t = v_t \cdot \alpha_c \cdot N_t
\end{equation}

\newpage
\subsubsection{Fees Received by Havven Holders}

\noindent The fee rate paid to a havven holder that has escrowed is $\alpha_r$.
The actual fee they receive is $\check{H_i} \cdot \alpha_r$, being proportional with the value they stake.
The received fee rate changes with respect their unique collaterilisation ratio, $C_i$.
It increases linearly to a maximum $\alpha_{base}$ at the optimal collaterilisation ratio $C_{opt}$, before quickly
diminishing as $C_i$ approaches the maximum collaterisation ratio $C_{max}$. 

\noindent This function is designed to encourage havven holders to constantly
target the optimal collateralisation ratio, by rewarding them with greater
fees if they do so.\\


 % \todo[inline]{figure out whether t stays}

\begin{equation}
\alpha_{r,t,i} = \alpha_{base,t} \cdot \mathcal{F}_{i,t}(C_{i,t}, C_{opt}, C_{max,t})  \label{eq:feesreceived}
\end{equation}

\begin{equation}
\mathcal{F}_{i,t}(C_{i,t}, C_{opt,t}, C_{max,t}) = 
\begin{cases}
 \frac{C_{i,t}}{C_{opt,t}} &\mbox{when } C_{i,t} \leq C_{opt,t} \\[1em]
 \frac{C_{max,t} - C_{i,t}}{C_{max,t} - C_{opt,t}} &\mbox{when } C_{opt,t} \leq C_{i,t} \leq C_{max,t} \\[1em]
 0 &\mbox{otherwise}
 \end{cases}
 \label{eq:7}
\end{equation}

\begin{center}
\begin{tikzpicture}[scale=3]

% draw axes
\draw [<->, thick] (0,2) node (yaxis) [above] {$\alpha_r$} |- (2.5,0) node (xaxis) [right] {$C_i$};

% draw two lines
\draw (0.0, 0.0) coordinate (a_1) -- (1.75,0.75) coordinate (a_2);
\draw (1.75, 0.75) coordinate (a_1) -- (2.25,0.0) coordinate (a_2);

\coordinate (c) at (1.75, 0.75);
\coordinate (d) at (2.25, 0.0);
\coordinate (e) at (0.00, 0.00);

\draw[dashed] (yaxis |- c) node [left] {$\alpha_{base}$} -| (xaxis -| c) node[below] {$C_{opt}$};
\draw[dashed] (yaxis |- e) node [left] {$\alpha_{base}$} -| (xaxis -| d) node[below] {$C_{max}$};

\end{tikzpicture}
\end{center}

\noindent This fee distribution curve encourages havven holders who have escrowed to maintain their $C_i$ at $C_{opt}$.  \\

\newpage

\subsubsection{Base Fee Rate}

Let us define the total fees paid to havven holders $F_{r,t}$: \\

\begin{equation}
F_{r,t} = \sum_{i} \check{H_i} \cdot \alpha_{r,t,i} \label{eq:totalfeesreceived}
\end{equation} \\

\noindent Havven requires that the total fees collected from users has to be equal to the total amount of
fees paid to the havven holders, so that $F_{r,t} = F_t$. Substituting our earlier definition \eqref{eq:feesreceived} for $\alpha_{r,t,i}$ and solving for $\alpha_{base,t} $: \\

\begin{equation}
\alpha_{base,t} = \frac{F_t}{\sum_{i} \check{H_i} \cdot \mathcal{F}_{i,t}(C_{i,t}, C_{opt,t}, C_{max,t})} \label{eq:10}
\end{equation} \\

\noindent We have now defined the maximum fee rate, $\alpha_{base}$, in terms of the fees collected, $F_t$. This rate should be achieved when an individual's $C_i$ is at $C_{opt}$. \\

\noindent The definition of $C_{opt}$ must therefore provide the following incentive. If $P_n > 1$ then the system must encourage more nomins to be issued. If $P_n < 1$, the system must encourage nomins to be burned. 

\newpage

\subsection{Collateralisation Ratio}
\subsubsection{Optimal Collateralisation Ratio}

\noindent The optimal collaterilisation ratio $C_{opt}$ is a target for havven
holders to reach in order to maximise the amount of fees they receive.
$C_{opt}$ is defined in terms of $P_n$ such that havven holders can
influence the price of nomins by manipulating their supply; a havven
holder can change their individual collateralisation ratio by
issuing or destroying nomins. \\
 
\noindent The function for $C_{opt}$ given below provides our dynamic target
for havven holders based on the price of nomins.

\noindent When $P_n$ is at \$1, $C_{opt} = C$; there is no incentive given
to move away from the current global collateralisation level. However, if
$P_n < \$1$, then $C_{opt} < C$, incentivising issuers to buy back nomins
to destroy to bring the price back up. The $P_n > \$1$ case is symmetric.
Notice that when $P_n$ is close to \$1, $ f'(P_n) $ is small.
However, the further $P_n$ diverges from \$1, the larger the slope becomes,
providing an increasing incentive (via fees) for a havven holder to move toward $C_{opt}$.

\begin{gather} 
\begin{align}
\begin{split}
C_{opt,t} &= f(P_{n,t}) \cdot C_t  \\ 
f(P_{N,t}) &= max(\sigma \cdot (P_{N,t} - 1)^{\phi} + 1, 0) \\
\sigma & \text{: price sensitivity parameter } (\sigma \geq 0)\\
\phi   & \text{: flattening parameter } (\phi \geq 1 \text{, } \phi \nmid 2) \\
\end{split}
\end{align}
\end{gather}


\begin{center}
\begin{tikzpicture}[scale=1.15]
\begin{axis}[
    axis lines = left,
    xlabel = $P_N$,
    ylabel = {$f(P_N)$},
    xtick = {1},
    ytick = {0},
    y label style={at={(axis description cs:.15,1.00)}, rotate=270,anchor=south},
    x label style={at={(axis description cs:1.05,.13)},anchor=north},
]
\addplot[
domain=0:2,
range=0:2
]
{(x-1)^3 + 1};
\addplot [
domain=0:2,
range=0:2,
dashed
]  
 {x};
 \addplot[dashed, samples=50, smooth,domain=0:6] coordinates {(1,1)(1,0)};
\end{axis}
\end{tikzpicture}
\end{center}

\newpage

\subsubsection{Maximum Collateralisation Ratio}

\noindent Havven seeks to maintain $C \leq C_{opt} < C_{max} < 1$, in order to retain sufficient collateral.
It might seem intuitive that $C_{max}$ should be a static value.
However, since $C_{opt}$ changes linearly with $P_n$ and inversely with $P_h$,
there are several situations where $C_{max}$ may need to change.
Below we define $C_{max}$. \\

\begin{equation}
\label{eq:12}
C_{max,t} = 
\begin{cases}
 C_{base,t} &\mbox{when } C_{opt,t} \leq C_{base,t} \\[1em]
 a \cdot C_{opt,t} &\mbox{otherwise}.
 \end{cases}
\end{equation}

\begin{center}
\begin{tikzpicture}[scale=3]

% draw axes
\draw [<->, thick] (0,2) node (yaxis) [above] {$C_{max}$} |- (2.5,0) node (xaxis) [right] {$C_{opt}$};

% draw intersecting lines
\draw (0.0, 0.75) coordinate (a_1) -- (0.75,0.75) coordinate (a_2);
\draw (0.75, 0.75) coordinate (a_1) -- (1.8,1.8) coordinate (a_2);

% calculate coordinate of intersection
\coordinate (c) at (0.75,0.75);

\draw[dashed] (yaxis |- c) node [left] {$C_{base}$} -| (xaxis -| c) node[below] {$C_{base}$};

\end{tikzpicture}
\end{center}

\noindent A collateralisation ratio less than $1$ implies that
the backing capital is more valuable than the tokens issued against it;
at $C = 1$, the total value of nomins in circulation equals the value of havvens
in circulation. Thus, choosing $C_{max}$ determines how overcollateralised the system
is at equilibrium. \\

\noindent The most significant tradeoff intrinsic in the selection of $C_{max}$
is then the one between \textit{efficiency} and \textit{resilience}. 
If $C_{max}$ is high, then the system is making more efficient use
of its backing capital, while if it is low, then it has a much greater capacity
to absorb negative shocks in the havven price before the system becomes
undercollateralised.

\noindent So a balance must be struck between the two, and where $C_{max}$
lies is what determines this balance. Here $C_{max}$ is defined as a
function of $C_{opt}$, which allows the control of the additional tradeoff 
between targeting a healthy collateralisation level and aggressive nomin price
stabilisation. \\

\noindent It should also be observed that using $C_{max} > 1$ corresponds to a
fractional reserve monetary system. In Havven, this situation is unstable:
if it were the case, a greater value in nomins could be issued against a single havven
than the value of that havven. In such a circumstance, the simultaneous appreciation
of havvens (up to at least the value of the nomins a havven can issue) and depreciation
of nomins immediately diminishes $C$, $C_{opt}$ and $C_{max}$, bringing them back under $1$.


\subsection{Fee Evasion}

\noindent Being based on Ethereum, Havven is potentially vulnerable to its tokens being wrapped by another
smart contract which takes deposits, and replicates all exchange functionality on redeemable IOU tokens
it issues. These wrapped tokens could then be exchanged without incurring fees. \\

\noindent We consider this situation unlikely for a number of reasons.

\noindent First, the fees are designed to be low enough that most users
shouldn't notice them, so users will not in general be strongly motivated to switch
to a marginal and less trustworthy alternative. \\
\noindent Second, network effect is tremendously important for currencies; in order to
become useful, any token must first be broadly accepted as ``legal'' tender. This is difficult
enough by itself, but a wrapped token must do this to the extent that it displaces its own perfect
substitute good: the token it wraps.

\noindent In the case of Havven, this would undermine built-in stabilisation mechanisms,
which become more powerful with increased transaction volume.
Consequently, as a wrapped nomin parasitises more of the nomin market,
it destroys the basis of its own utility, which is that nomins themselves are stable.

\noindent Finally, it is unlikely that any token wrapper will be credible,
not having been publicly and expensively audited, while its primary function
tends to redound against the trustworthiness of its authors. \\

\noindent Nevertheless, it's simple to implement a democratic method, weighted by havven balance,
by which havven holders can freeze or confiscate the balance of any contract that wraps assets.
Those havven holders are incentivised not to abuse this system for the same reason that
bitcoin mining pools do not form cartels to double-spend: because abuse of this power
would undermine the value of the system, and thus devalue their own holdings.

\noindent The credible threat of such a system existing is enough to discourage token wrappers
from being used, even if they are written, since any user who does so risks losing their
entire wrapped balance.

\newpage